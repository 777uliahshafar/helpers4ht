\RequirePackage{etoolbox,expl3,environ}
\ExplSyntaxOn
\cs_new_protected:Npn \alteqtoks #1
{
  \tl_set:Nx \l_tmpa_tl {\detokenize{#1}}
  % delete spaces before left brackets
  \regex_replace_all:nnN { \x{20} \x{7B} } { \x{7B} } \l_tmpa_tl
  % replace < > and & with xml entities
  \regex_replace_all:nnN { \x{26} } { &amp; } \l_tmpa_tl
  \regex_replace_all:nnN { \x{3C} } { &lt; } \l_tmpa_tl 
  \regex_replace_all:nnN { \x{3E} } { &gt; } \l_tmpa_tl
  \tl_set:Nx \l_tmpb_tl{ \l_tmpa_tl }
  \HCode{\l_tmpb_tl}
}

\ExplSyntaxOff
\AtBeginDocument{%
  \Configure{HTML}{\HCode{<html>\Hnewline}}{\HCode{\Hnewline</html>}}
  %\Configure{@HEAD}{\HCode{<link href="basic.css" rel="stylesheet" type="text/css" />\Hnewline}} 
  \Configure{@HEAD}{\HCode{
      <script type="text/x-mathjax-config">                                           
      MathJax.Hub.Config({
          TeX: {           
            extensions: ["color.js","AMSmath.js"], 
            equationNumbers: { autoNumber: "AMS" }
          },        
          extensions: ["tex2jax.js"], 
          tex2jax: {       
            \unexpanded{
              inlineMath: [ ["\\\(","\\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],}
            processEscapes: true,
            processEnvironments: true
          }                   
      });                  
      </script>\Hnewline
  }}
  \Configure{@HEAD}{\HCode{ <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> \Hnewline}}
  \def\AltMathOne#1${\alteqtoks{\(#1\)}$}
  \Configure{$}{}{}{\expandafter\AltMathOne} 
  \def\AltlMath#1\){\alteqtoks{\(#1\)}\)}
  \Configure{()}{\AltlMath}{}
  \def\AltlDisplay#1\]{\alteqtoks{\[#1\]}\]}
  \Configure{[]}{\AltlDisplay}{}

\newcommand\VerbMathToks[2]{%
  \alteqtoks{\begin{#2}
    #1
  \end{#2}}%
}
\newcommand\VerbMath[1]{%
\ifcsdef{#1}{%
  \RenewEnviron{#1}{%
  \NoFonts\expandafter\VerbMathToks\expandafter{\BODY}{#1}\EndNoFonts%
  }
}{}%
}
\VerbMath{align}
\VerbMath{equation}
\VerbMath{equation*}
\VerbMath{align*}
\VerbMath{cases}
\VerbMath{array}
\VerbMath{matrix}
\VerbMath{pmatrix}
\VerbMath{eqnarray}
\VerbMath{eqnarray*}
  }
